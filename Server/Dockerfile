FROM golang:1.22

# Server
ENV PORT=$PORT
ENV ENV=$ENV
# Ipinfo service
ENV IPINFO_SERVICE_API_KEY=$IPINFO_SERVICE_API_KEY
# Database
ENV POSTGRES_DRIVER=$POSTGRES_DRIVER
ENV POSTGRES_MIGRATE=$POSTGRES_MIGRATE
ENV POSTGRES_MIGRATION=$POSTGRES_MIGRATE
ENV POSTGRES_NAME=$POSTGRES_NAME
ENV POSTGRES_PASS=$POSTGRES_PASS
ENV POSTGRES_READER=$POSTGRES_READER
ENV POSTGRES_WRITER=$POSTGRES_WRITER
ENV POSTGRES_USER=$POSTGRES_USER
# Jwt
ENV JWT_EXPIRES=$JWT_EXPIRES
ENV JWT_SECRET=$JWT_SECRET
# Google
ENV GOOGLE_ADC=$GOOGLE_ADC
ENV GOOGLE_CLOUD_BASE_OBJECT_URI=$GOOGLE_CLOUD_BASE_OBJECT_URI
ENV GOOGLE_CLOUD_STORAGE_BUCKET=$GOOGLE_CLOUD_STORAGE_BUCKET
# Paystack
ENV PAYSTACK_BASE_API=$PAYSTACK_BASE_API
ENV PAYSTACK_SECRET_KEY=$PAYSTACK_SECRET_KEY
#staging/prod:sk_live_a70c9cfea2f5da059690fc18ab7cb5d577c8224d
ENV PAYSTACK_MOBILE_TEST_ACCOUNT=$PAYSTACK_MOBILE_TEST_ACCOUNT
ENV PAYSTACK_PAYMENT_PROVIDER=$PAYSTACK_PAYMENT_PROVIDER
# Fees
ENV POSTER_RIGHTS_FEE=$POSTER_RIGHTS_FEE
ENV FARMING_RIGHTS_FEE=$FARMING_RIGHTS_FEE
# Redis
ENV REDIS_ENDPOINT=$REDIS_ENDPOINT
# Sentry
ENV SENTRY_DSN=$SENTRY_DSN

RUN mkdir -p go/src/copod
WORKDIR go/src/copod
COPY . .
RUN make tidy

EXPOSE 4000
EXPOSE 4001

RUN make copod